create table jes_domains (domain_id INT NOT NULL PRIMARY KEY GENERATED ALWAYS AS IDENTITY,domain_name varchar(1024) NOT NULL, domain_name_lower_case varchar(1024) NOT NULL UNIQUE);
create table jes_users (user_id INT NOT NULL PRIMARY KEY GENERATED ALWAYS AS IDENTITY,username varchar(1024) NOT NULL, username_lower_case varchar(1024) NOT NULL, domain_id INT NOT NULL,password char(60),salt char(48),password_25 long varchar NOT NULL,CONSTRAINT username_lower_case_domain_id UNIQUE(domain_id, username_lower_case), CONSTRAINT domain_id_fk_1 FOREIGN KEY (domain_id) REFERENCES jes_domains(domain_id) ON DELETE CASCADE);
create table jes_default_mailbox (domain_id INT NOT NULL PRIMARY KEY, user_id INT NOT NULL, CONSTRAINT domain_id_fk_2 FOREIGN KEY (domain_id) REFERENCES jes_domains(domain_id) ON DELETE CASCADE, CONSTRAINT user_id_fk_1 FOREIGN KEY (user_id) REFERENCES jes_users(user_id) ON DELETE CASCADE);
create table jes_user_forwards (user_forward_id INT NOT NULL PRIMARY KEY GENERATED ALWAYS AS IDENTITY, user_id INT NOT NULL, forward_address varchar(2048) NOT NULL, CONSTRAINT user_id_forward_address_uk UNIQUE (user_id, forward_address), CONSTRAINT user_id_fk_2 FOREIGN KEY (user_id) REFERENCES jes_users(user_id) ON DELETE CASCADE);
create table jes_realms (realm_id INT NOT NULL PRIMARY KEY GENERATED ALWAYS AS IDENTITY, realm_name varchar(1024) NOT NULL, realm_name_lower_case varchar(1024) NOT NULL, domain_id INT, CONSTRAINT domain_id_fk_3 FOREIGN KEY (domain_id) REFERENCES jes_domains(domain_id) ON DELETE CASCADE, CONSTRAINT realm_name_lower_case_domain_id_uk UNIQUE (realm_name_lower_case, domain_id));
create table jes_realm_users (realm_id INT NOT NULL, user_id INT NOT NULL, domain_id INT NOT NULL, password char(96) NOT NULL, CONSTRAINT realm_id_user_id_pk PRIMARY KEY(realm_id, user_id), CONSTRAINT realm_id_fk_1 FOREIGN KEY (realm_id) REFERENCES jes_realms(realm_id) ON DELETE CASCADE, CONSTRAINT user_id_fk_3 FOREIGN KEY (user_id) REFERENCES jes_users(user_id) ON DELETE CASCADE, CONSTRAINT domain_id_fk_4 FOREIGN KEY (domain_id) REFERENCES jes_domains(domain_id) ON DELETE CASCADE);
create table jes_misc (default_domain_id INT, version varchar(12) NOT NULL);
alter table jes_realms alter column realm_id restart with 0;
insert into jes_realms (realm_name, realm_name_lower_case) VALUES ('null', 'null');
insert into jes_misc (version) values('2.8');
